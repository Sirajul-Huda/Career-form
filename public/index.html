<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Career Form</title>
    <link rel="icon" type="image/x-icon" href="./logo without text 1.svg">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
</head>

<body>
    <div class="container-main">
        <div class="career-main">
            <form class="form-career" enctype="multipart/form-data" id="frm1">
                <div class="main-items" data-aos="fade-down">
                    <img src="./images/Sirajulhuda English s.png" class="logo-main" alt="">
                    <h2 class="team-heading mb-0">Join Our Team</h2>
                </div>
                <div class="form-group">
                    <label for="cv" class="form-label">Upload CV</label>
                    <input class="form-control" type="file" id="cv" name="cv">
                </div>
                <div class="form-group">
                    <label for="position">Select Position</label>
                    <select class="form-control" id="position" name="position_id">
                        <option value="">Loading...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" class="form-control" id="phone" name="phone" placeholder="Enter your phone number">
                </div>
                <div class="form-group">
                    <label for="whats_app">WhatsApp Number</label>
                    <input type="tel" class="form-control" id="whats_app" name="whats_app" placeholder="Enter your WhatsApp number">
                </div>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" class="form-control" id="email" name="email" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="name">Enter your name</label>
                    <input type="text" class="form-control" id="name" name="name" placeholder="Name">
                </div>
                <div class="form-group">
					<label for="house">House Name</label>
					<input type="text" class="form-control" id="house" name="house" placeholder="House name">
				</div>
				<div class="form-group">
					<label for="place">Place</label>
					<input type="text" class="form-control" id="place" name="place" placeholder="Place">
				</div>
				<div class="form-group">
					<label for="post">Post</label>
					<input type="text" class="form-control" id="post" name="post" placeholder="Post">
				</div>
				<div class="form-group">
					<label for="district">District</label>
					<input type="text" class="form-control" id="district" name="district" placeholder="District">
				</div>
				<div class="form-group">
					<label for="state">State</label>
					<input type="text" class="form-control" id="state" name="state" placeholder="State">
				</div>
                <div class="form-group">
                    <label for="experience">Work experience</label>
                    <input type="text" class="form-control" id="experience" name="experience" placeholder="Experience">
                </div>
                <div class="submit-button">
                    <button type="submit" class="btn btn-submit">Submit</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const positionSelect = document.getElementById('position');

            try {
                const response = await fetch('https://api.sirajulhuda.com/api/v1/career-portal/job-openings/list');
                const data = await response.json();

                if (data.status === 200 && Array.isArray(data.data)) {
                    positionSelect.innerHTML = '<option value="">Select a position</option>';
                    data.data.forEach(position => {
                        positionSelect.innerHTML += `<option value="${position.id}">${position.name}</option>`;
                    });
                } else {
                    throw new Error('Invalid data format');
                }
            } catch (error) {
                console.error('Error fetching job positions:', error);
                positionSelect.innerHTML = '<option value="">Error loading positions</option>';
            }
        });

        document.getElementById('frm1').addEventListener('submit', async (event) => {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);

            // Validate position selection
            const positionId = formData.get('position_id');
            if (!positionId) {
                alert('Please select a position');
                return;
            }
			console.log(formData);

            try {
                const response = await fetch('https://api.sirajulhuda.com/api/v1/career-portal/job-application/create', {
                    method: 'POST',
                    body: formData,
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                alert(result.message || 'Application submitted successfully');
                form.reset(); // Reset the form after successful submission
            } catch (error) {
                console.error('Error submitting application:', error);
                alert('Error submitting application. Please try again.');
            }
        });
    </script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
</body>

</html>